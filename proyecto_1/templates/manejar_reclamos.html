{% extends 'base.html' %}

{% block page_content %}
    <h2>Manejar Reclamos</h2>

    {% if usuario.rol == 'jefe' %}
        <p class="lead">Mostrando todos los reclamos asignados al departamento: <b>{{ usuario.departamento.title() }}</b></p>
    {% else %}
        <p class="lead">Mostrando <b>todos</b> los reclamos del sistema (Vista de Secretaría Técnica).</p>
    {% endif %}
    <hr>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Estado</th>
                    <th>Contenido</th>
                    <th>Departamento</th>
                    <th>Creador</th>
                    <th>Fecha</th>
                    <th>Adh.</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
            {% if reclamos %}
                {% for reclamo in reclamos %}
                    <tr>
                        <td><b>{{ reclamo.id_reclamo }}</b></td>

                        <td>
                            {% if reclamo.estado == 'pendiente' %}
                                <span class="badge bg-warning text-dark">{{ reclamo.estado }}</span>
                            {% elif reclamo.estado == 'en proceso' %}
                                <span class="badge bg-info text-dark">{{ reclamo.estado }}</span>
                            {% elif reclamo.estado == 'resuelto' %}
                                <span class="badge bg-success">{{ reclamo.estado }}</span>
                            {% else %}
                                <span class="badge bg-danger">{{ reclamo.estado }}</span>
                            {% endif %}
                        </td>

                        <td>{{ reclamo.contenido|truncate(100) }}</td>
                        <td>{{ reclamo.departamento.title() }}</td>
                        <td>{{ reclamo.usuario_creador.nombre_usuario }}</td>
                        <td>{{ reclamo.timestamp.strftime('%Y-%m-%d') }}</td>
                        <td>{{ reclamo.numero_adherentes }}</td>

                        <td>
                            {% if usuario.rol == 'jefe' %}
                                <a href="{{ url_for('editar_estado', id_reclamo=reclamo.id_reclamo) }}" class="btn btn-primary btn-sm">Editar Estado</a>
                            {% endif %}
                            
                            {% if usuario.rol == 'secretario' %}
                                <a href="{{ url_for('derivar_reclamo', id_reclamo=reclamo.id_reclamo) }}" class="btn btn-warning btn-sm">Derivar</a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="8" class="text-center">No se encontraron reclamos para este departamento.</td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>

    <a href="{{ url_for('panel_principal') }}" class="btn btn-secondary mt-3">Volver al Panel</a>
{% endblock %}